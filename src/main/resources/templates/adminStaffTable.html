<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <style>
      .centered {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    </style>

    <div th:replace="common :: header"></div>
    <title>Admin</title>

    <nav class="navbar navbar-dark fixed-top" style="background: #1e3770">
      <div class="container-fluid">
        <a
          class="navbar navbar-brand"
          style="font-size: 28px; margin-left: 128px"
          href="#"
        >
          Cowin Lite
        </a>
      </div>
    </nav>
    <nav class="navbar navbar-dark fixed-bottom" style="background: #1e3770">
      <div class="container-fluid">
        <span class="navbar-brand mx-auto"
          >Optimize IT Systems Â© 2021 COWIN Lite</span
        >
      </div>
    </nav>
  </head>

  <body style="margin-top: 100px; margin-bottom: 80px">
    <h3>Registered Staff Members</h3>
    <span id="user_id" th:text="${user1}"></span>

    <div class="mb-3 mt-3">
      <table id="dtUsers" class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr style="font-size: 20px">
            <th>#</th>
            <th>Name</th>
            <th>Phone</th>
            <th>Update</th>
          </tr>
        </thead>
        <tbody>
          <tr style="font-size: 18px" th:each="user, iterStat:${users}">
            <td th:text="${iterStat.index}+1"></td>
            <td th:text="${user.name}"></td>
            <td th:text="${user.phoneNumber}"></td>
            <td>
              <button id="edit_btn" type="button" class="btn btn-info">
                Edit
              </button>
              <button id="delete_btn" type="button" class="btn btn-info">
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>

  <div th:replace="common :: footer"></div>

  <script>
    $(document).ready(function () {
      $("#dtUsers").DataTable();
    });

    $(document).on("click", "#edit_btn", function () {
      var id = $(this).closest("tr").find("td:eq(0)").text();
      var memberName = $(this).closest("tr").find("td:eq(1)").text();
      var phnNumber = $(this).closest("tr").find("td:eq(2)").text();
      console.log(id + " " + memberName + " " + phnNumber);


    $(document).on("click", "#delete_btn", function () {
      var phoneNumber = $(this).closest("tr").find("td:eq(2)").text();

      $.confirm({
        title: "Delete staff member",
        buttons: {
          deleteUser: {
            text: "delete",
            action: function () {
              $.ajax({
                type: "DELETE",
                contentType: "application/json",
                url: "/admin/" + phoneNumber,
                success: function (result) {
                  console.log(result);
                  if (result == "success") {
                    $.confirm({
                      title: "Success",
                      content: "Staff member deleted successfully",
                      buttons: {
                        ok: function () {
                          location.reload();
                        },
                      },
                    });
                  } else {
                    $.alert("Staff member deletion failed");
                  }
                },
              });
            },
          },
          cancel: function () {
            //close
          },
        },
      });
    });
  </script>
</html>
